{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/mental-health-app';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable');\r\n}\r\n\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n  cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose\r\n      .connect(MONGODB_URI, opts)\r\n      .then((mongoose) => {\r\n        return mongoose;\r\n      });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\ndeclare global {\r\n  var mongoose: any;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAIA,IAAI,SAAS,yDAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CACtB,OAAO,CAAC,aAAa,MACrB,IAAI,CAAC,CAAC;YACL,OAAO;QACT;IACJ;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/models/Booking.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\n\r\nexport interface IBooking extends Document {\r\n  studentId: string;\r\n  counselorId: string;\r\n  appointmentDate: Date;\r\n  appointmentTime: string;\r\n  duration: number;\r\n  status: 'scheduled' | 'completed' | 'cancelled' | 'no-show';\r\n  notes?: string;\r\n  meetingLink?: string;\r\n  cancellationReason?: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst bookingSchema = new Schema<IBooking>(\r\n  {\r\n    studentId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'User',\r\n      required: true,\r\n    },\r\n    counselorId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Counselor',\r\n      required: true,\r\n    },\r\n    appointmentDate: {\r\n      type: Date,\r\n      required: true,\r\n    },\r\n    appointmentTime: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    duration: { type: Number, default: 60 },\r\n    status: {\r\n      type: String,\r\n      enum: ['scheduled', 'completed', 'cancelled', 'no-show'],\r\n      default: 'scheduled',\r\n    },\r\n    notes: String,\r\n    meetingLink: String,\r\n    cancellationReason: String,\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nexport const Booking = mongoose.models.Booking || mongoose.model<IBooking>('Booking', bookingSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,aAAa;QACX,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,iBAAiB;QACf,MAAM;QACN,UAAU;IACZ;IACA,iBAAiB;QACf,MAAM;QACN,UAAU;IACZ;IACA,UAAU;QAAE,MAAM;QAAQ,SAAS;IAAG;IACtC,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAa;YAAa;YAAa;SAAU;QACxD,SAAS;IACX;IACA,OAAO;IACP,aAAa;IACb,oBAAoB;AACtB,GACA;IAAE,YAAY;AAAK;AAGd,MAAM,UAAU,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';\r\n\r\nexport interface JWTPayload {\r\n  userId: string;\r\n  email: string;\r\n  role: 'student' | 'counselor' | 'admin';\r\n}\r\n\r\nexport const generateToken = (payload: JWTPayload): string => {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\r\n};\r\n\r\nexport const verifyToken = (token: string): JWTPayload | null => {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET) as JWTPayload;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const decodeToken = (token: string): JWTPayload | null => {\r\n  try {\r\n    return jwt.decode(token) as JWTPayload;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,MAAM,gBAAgB,CAAC;IAC5B,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,MAAM,cAAc,CAAC;IAC1B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,MAAM,cAAc,CAAC;IAC1B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/app/api/bookings/route.ts"],"sourcesContent":["import { connectToDatabase } from '@/lib/mongodb';\r\nimport { Booking } from '@/models/Booking';\r\nimport { verifyToken } from '@/lib/auth';\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport async function GET(request: Request) {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const authHeader = request.headers.get('authorization');\r\n    if (!authHeader) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    const decoded = verifyToken(token);\r\n    if (!decoded) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid token' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const bookings = await Booking.find({ studentId: decoded.userId })\r\n      .populate('counselorId')\r\n      .populate('studentId', 'name email')\r\n      .sort({ appointmentDate: -1 });\r\n\r\n    return NextResponse.json({ bookings }, { status: 200 });\r\n  } catch (error) {\r\n    console.error('Fetch bookings error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch bookings' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const authHeader = request.headers.get('authorization');\r\n    if (!authHeader) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    const decoded = verifyToken(token);\r\n    if (!decoded) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid token' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { counselorId, appointmentDate, appointmentTime, notes } = body;\r\n\r\n    if (!counselorId || !appointmentDate || !appointmentTime) {\r\n      return NextResponse.json(\r\n        { error: 'Missing required fields' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const booking = new Booking({\r\n      studentId: decoded.userId,\r\n      counselorId,\r\n      appointmentDate: new Date(appointmentDate),\r\n      appointmentTime,\r\n      notes,\r\n      status: 'scheduled',\r\n    });\r\n\r\n    await booking.save();\r\n\r\n    try {\r\n      const { getIO } = await import('@/lib/socket');\r\n      const io = getIO();\r\n      io.to(`user:${counselorId}`).emit('notification:new', {\r\n        type: 'booking',\r\n        title: 'New Appointment Booking',\r\n        message: `You have a new appointment booking for ${appointmentDate}`,\r\n        data: { bookingId: booking._id, appointmentDate, appointmentTime },\r\n      });\r\n    } catch (error) {\r\n      console.error('Socket.io error:', error);\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { booking },\r\n      { status: 201 }\r\n    );\r\n  } catch (error) {\r\n    console.error('Create booking error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create booking' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,IAAA,qIAAiB;QAEvB,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;QACtC,MAAM,UAAU,IAAA,4HAAW,EAAC;QAC5B,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgB,GACzB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,MAAM,8HAAO,CAAC,IAAI,CAAC;YAAE,WAAW,QAAQ,MAAM;QAAC,GAC7D,QAAQ,CAAC,eACT,QAAQ,CAAC,aAAa,cACtB,IAAI,CAAC;YAAE,iBAAiB,CAAC;QAAE;QAE9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAS,GAAG;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,IAAA,qIAAiB;QAEvB,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;QACtC,MAAM,UAAU,IAAA,4HAAW,EAAC;QAC5B,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgB,GACzB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,WAAW,EAAE,eAAe,EAAE,eAAe,EAAE,KAAK,EAAE,GAAG;QAEjE,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,iBAAiB;YACxD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,IAAI,8HAAO,CAAC;YAC1B,WAAW,QAAQ,MAAM;YACzB;YACA,iBAAiB,IAAI,KAAK;YAC1B;YACA;YACA,QAAQ;QACV;QAEA,MAAM,QAAQ,IAAI;QAElB,IAAI;YACF,MAAM,EAAE,KAAK,EAAE,GAAG;YAClB,MAAM,KAAK;YACX,GAAG,EAAE,CAAC,CAAC,KAAK,EAAE,aAAa,EAAE,IAAI,CAAC,oBAAoB;gBACpD,MAAM;gBACN,OAAO;gBACP,SAAS,CAAC,uCAAuC,EAAE,iBAAiB;gBACpE,MAAM;oBAAE,WAAW,QAAQ,GAAG;oBAAE;oBAAiB;gBAAgB;YACnE;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,oBAAoB;QACpC;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE;QAAQ,GACV;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}