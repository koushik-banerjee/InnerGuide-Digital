{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/mental-health-app';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable');\r\n}\r\n\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n  cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose\r\n      .connect(MONGODB_URI, opts)\r\n      .then((mongoose) => {\r\n        return mongoose;\r\n      });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\ndeclare global {\r\n  var mongoose: any;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAIA,IAAI,SAAS,yDAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CACtB,OAAO,CAAC,aAAa,MACrB,IAAI,CAAC,CAAC;YACL,OAAO;QACT;IACJ;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/models/Analytics.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\n\r\nexport interface IAnalytics extends Document {\r\n  userId: string;\r\n  date: Date;\r\n  moodScore: number; // 1-5 scale\r\n  stressLevel: number; // 1-5 scale\r\n  sleepHours: number;\r\n  exerciseMinutes: number;\r\n  chatInteractions: number;\r\n  forumPosts: number;\r\n  counselingSessionsAttended: number;\r\n  resourcesViewed: number;\r\n  notes?: string;\r\n  createdAt: Date;\r\n}\r\n\r\nconst analyticsSchema = new Schema<IAnalytics>(\r\n  {\r\n    userId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'User',\r\n      required: true,\r\n    },\r\n    date: {\r\n      type: Date,\r\n      default: Date.now,\r\n    },\r\n    moodScore: { type: Number, min: 1, max: 5 },\r\n    stressLevel: { type: Number, min: 1, max: 5 },\r\n    sleepHours: Number,\r\n    exerciseMinutes: Number,\r\n    chatInteractions: { type: Number, default: 0 },\r\n    forumPosts: { type: Number, default: 0 },\r\n    counselingSessionsAttended: { type: Number, default: 0 },\r\n    resourcesViewed: { type: Number, default: 0 },\r\n    notes: String,\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nanalyticsSchema.index({ userId: 1, date: -1 });\r\n\r\nexport const Analytics = mongoose.models.Analytics || mongoose.model<IAnalytics>('Analytics', analyticsSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,MAAM,kBAAkB,IAAI,mHAAM,CAChC;IACE,QAAQ;QACN,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,SAAS,KAAK,GAAG;IACnB;IACA,WAAW;QAAE,MAAM;QAAQ,KAAK;QAAG,KAAK;IAAE;IAC1C,aAAa;QAAE,MAAM;QAAQ,KAAK;QAAG,KAAK;IAAE;IAC5C,YAAY;IACZ,iBAAiB;IACjB,kBAAkB;QAAE,MAAM;QAAQ,SAAS;IAAE;IAC7C,YAAY;QAAE,MAAM;QAAQ,SAAS;IAAE;IACvC,4BAA4B;QAAE,MAAM;QAAQ,SAAS;IAAE;IACvD,iBAAiB;QAAE,MAAM;QAAQ,SAAS;IAAE;IAC5C,OAAO;AACT,GACA;IAAE,YAAY;AAAK;AAGrB,gBAAgB,KAAK,CAAC;IAAE,QAAQ;IAAG,MAAM,CAAC;AAAE;AAErC,MAAM,YAAY,oHAAQ,CAAC,MAAM,CAAC,SAAS,IAAI,oHAAQ,CAAC,KAAK,CAAa,aAAa"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';\r\n\r\nexport interface JWTPayload {\r\n  userId: string;\r\n  email: string;\r\n  role: 'student' | 'counselor' | 'admin';\r\n}\r\n\r\nexport const generateToken = (payload: JWTPayload): string => {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\r\n};\r\n\r\nexport const verifyToken = (token: string): JWTPayload | null => {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET) as JWTPayload;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const decodeToken = (token: string): JWTPayload | null => {\r\n  try {\r\n    return jwt.decode(token) as JWTPayload;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,MAAM,gBAAgB,CAAC;IAC5B,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,MAAM,cAAc,CAAC;IAC1B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,MAAM,cAAc,CAAC;IAC1B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/4th%20year/InnerGuide-Digital/app/api/analytics/user/route.ts"],"sourcesContent":["import { connectToDatabase } from '@/lib/mongodb';\r\nimport { Analytics } from '@/models/Analytics';\r\nimport { verifyToken } from '@/lib/auth';\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport async function GET(request: Request) {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const authHeader = request.headers.get('authorization');\r\n    if (!authHeader) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    const decoded = verifyToken(token);\r\n    if (!decoded) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid token' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const days = parseInt(searchParams.get('days') || '30');\r\n\r\n    const endDate = new Date();\r\n    const startDate = new Date(endDate.getTime() - days * 24 * 60 * 60 * 1000);\r\n\r\n    const data = await Analytics.find({\r\n      userId: decoded.userId,\r\n      date: { $gte: startDate, $lte: endDate },\r\n    }).sort({ date: 1 });\r\n\r\n    const avgMood = data.length > 0 \r\n      ? (data.reduce((sum, d) => sum + (d.moodScore || 0), 0) / data.length).toFixed(1)\r\n      : 0;\r\n    const avgStress = data.length > 0\r\n      ? (data.reduce((sum, d) => sum + (d.stressLevel || 0), 0) / data.length).toFixed(1)\r\n      : 0;\r\n    const totalSleep = data.reduce((sum, d) => sum + (d.sleepHours || 0), 0);\r\n    const totalExercise = data.reduce((sum, d) => sum + (d.exerciseMinutes || 0), 0);\r\n\r\n    return NextResponse.json(\r\n      {\r\n        data,\r\n        summary: {\r\n          avgMood,\r\n          avgStress,\r\n          totalSleep,\r\n          totalExercise,\r\n          daysTracked: data.length,\r\n        },\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (error) {\r\n    console.error('Fetch analytics error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch analytics' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const authHeader = request.headers.get('authorization');\r\n    if (!authHeader) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    const decoded = verifyToken(token);\r\n    if (!decoded) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid token' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const analytics = await Analytics.findOneAndUpdate(\r\n      { userId: decoded.userId, date: today },\r\n      { ...body, userId: decoded.userId, date: today },\r\n      { new: true, upsert: true }\r\n    );\r\n\r\n    return NextResponse.json({ analytics }, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Create analytics error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to save analytics' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}